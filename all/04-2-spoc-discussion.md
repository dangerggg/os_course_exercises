#lec9: 虚存置换算法spoc练习

## 视频相关思考题

### 9.1 页面置换算法的概念

1. 设计置换算法时需要考虑哪些影响因素？如何评判的好坏？

   尽可能减少页面的操作次数，把未来或近期不再访问的页面调出

   模拟置换行为，记录缺页次数

2. 全局和局部置换算法的不同？

   全局置换算法关心所有可能换出的页面，并不局限于单个进程

   局部置换算法仅限于当前进程的页面置换并且分配给每个进程的物理页面数量已经确定

### 9.2 最优算法、先进先出算法和最近最久未使用算法

1. 最优算法、先进先出算法和LRU算法的思路？

   最优算法：预测未来，将未来最长时间不会被访问的页面换出

   FIFO：选择在内存中驻留时间最久的页面换出

   LRU：选择内存中最长时间没有被引用的页面进行置换

   思路的不同点在于根据什么依据来选择置换的页面和组织内存中的逻辑页面

### 9.3 时钟置换算法和最不常用算法

1. 时钟置换算法的思路？

   时钟置换算法是FIFO和LRU的折中，本质上页面的换入换出还是FIFO的原则。

   时钟算法从当前指针开始寻找未被访问过的页面换出，指针在开始时指向最先调入的页面，在FIFO的原则上考虑了页面访问的情况，降低了开销。

2. 改进的时钟置换算法与时钟置换算法有什么不同？

   改进的时钟置换算法考虑了进程对页的读和写两种情况，避免了把被修改过的页换出时仍要写到外存中的开销，改进的时钟算法引入修改位并且直接跳过被修改的位。

3. LFU算法的思路？

   选择最近最少被使用的页面换出，会造成一段时间内频繁访问，但是之后不再访问的页面换出较为复杂。


### 9.4 Belady现象和局部置换算法比较

1. 什么是Belady现象？如何判断一种置换算法是否存在Belady现象？

   Belady现象是指增加分配给一个进程的物理页面数，缺页率反而会提升。

   类似于FIFO这种队列式的置换方法可以构造反例，类似于LRU可以证明算法是栈式替换算法

2. 请证明LRU算法不存在Belady现象。

   由于LRU是栈式置换算法，因此增加物理页面会增加栈的大小，根据栈式置换算法的特征，新加入的页面会将栈底的页面压出，因此增加大小的栈中的物理页面的集合一定包含原栈中的物理页面的集合，这样的话缺页率一定不会提升。

### 9.5 工作集置换算法

1. CPU利用率与并发进程数的关系是什么？

   先互相促进，在并发进程数达到一定的大小时，呈现互相制约的关系

2. 什么是工作集？

   一个进程在当前时刻正在使用的逻辑页面的集合，常用当前时刻前一段时间访问过的逻辑页面进行近似

3. 什么是常驻集？

   当前时刻，进程实际驻留在物理内存中的页面的集合

4. 工作集算法的思路？

   从内存中换出当前不在工作集中的页面，这就意味着每一次访存都要进行内存中页面的管理，这种开销无疑是无法忍受的

### 9.6 缺页率置换算法

1. 缺页率算法的思路？

   缺页率算法是对工作集算法的一种改进，缺页率算法并不是每次访存都会对常驻集进行管理。只有在缺页发生时，缺页率置换算法考察缺页的时间间隔来估计出缺页率，根据缺页率的大小来考虑是否对当前的常驻集进行维护和修改。

### 9.7 抖动和负载控制

1. 什么是虚拟内存管理的抖动现象？

   进程分配物理页面较少，频繁进行缺页处理，导致CPU效率下降

2. 操作系统负载控制的最佳状态是什么状态？

   处理异常时间 = 缺页的时间间隔

3. 局部置换算法（如FIFO, LRU等）是否能作为全局置换算法来使用？为什么？

   不能，局部置换算法考虑的太片面，用到全局有很多不合适的地方。

----

## 扩展思考题

1. 改进时钟置换算法的极端情况: 如果所有的页面都被修改过了，这时需要分配新的页面时，算法的performance会如何？能否改进在保证正确的前提下提高缺页中断的处理时间？

   需要至少两次的全遍历，效率很低且开销大

   可以使用空间换时间，另维护一个待我们选择的页的表，当我们遍历到被修改过的页时，直接删除，这样可以减少无谓的遍历时间。

2. 如何设计改进时钟算法的写回策略?

   增加写回位，操作系统在遍历到脏页时，跳过该页并将写回位置一，CPU会根据写回位的变化处理页的写回操作，当写回操作完成时将写回位和修改位同时置零。

3. （spoc）根据你的`学号 mod 4`的结果值，确定选择四种页面置换算法（0：LRU置换算法，1:改进的clock 页置换算法，2：工作集页置换算法，3：缺页率置换算法）中的一种来设计一个应用程序（可基于python, ruby, C, C++，LISP等）模拟实现，并给出测试用例和测试结果。请参考如python代码或独自实现。
 - [页置换算法实现的参考实例](https://github.com/chyyuu/ucore_lab/blob/master/related_info/lab3/page-replacement-policy.py)     

4. 请判断OPT、LRU、FIFO、Clock和LFU等各页面置换算法是否存在Belady现象？如果存在，给出实例；如果不存在，给出证明。

   OPT和LRU都不存在（OPT不用说，LRU是栈式置换算法）

   FIFO和Clock原则类似，都有Belady现象

   LFU不是先进先出的算法，而是类似于LRU的栈式算法，因此没有Belady现象

5. 了解LIRS页置换算法的设计思路，尝试用高级语言实现其基本思路。此算法是江松博士（导师：张晓东博士）设计完成的，非常不错！

  - 参考信息：
 	- [LIRS conf paper](http://www.ece.eng.wayne.edu/~sjiang/pubs/papers/jiang02_LIRS.pdf)
	 - [LIRS journal paper](http://www.ece.eng.wayne.edu/~sjiang/pubs/papers/jiang05_LIRS.pdf)
	 - [LIRS-replacement ppt1](http://dragonstar.ict.ac.cn/course_09/XD_Zhang/(6)-LIRS-replacement.pdf)
	 - [LIRS-replacement ppt2](http://www.ece.eng.wayne.edu/~sjiang/Projects/LIRS/sig02.ppt)
